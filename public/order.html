<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kolejność graczy</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <div id="game-sect">
      <p><h1>Kolejność graczy</h1></p>

      <div id="orderArea" style="margin-bottom: 30px;"></div>

      <button id="readyBtn">Przejdź dalej</button>
      <p id="readyInfo"></p>
    </div>
  </main>

<script src="/socket.io/socket.io.js"></script>
<script>
const params = new URLSearchParams(location.search);
const lobbyId = params.get('lobby');
const name = params.get('name');

const orderArea = document.getElementById('orderArea');
const readySection = document.getElementById('readySection');
const readyBtn = document.getElementById('readyBtn');
const readyInfo = document.getElementById('readyInfo');

const socket = io();

// Poproś serwer o kolejność graczy
socket.emit('getPlayerOrder', { lobbyId });

// Odbiór kolejności od serwera (ta sama dla wszystkich)
socket.on('playerOrder', (players) => {
  orderArea.innerHTML = '<ol style="margin-bottom:20px;">' + players.map(p => `<li>${p}</li>`).join('') + '</ol>';
  readySection.style.display = 'block';
  readyBtn.disabled = false;
});

// debug: połączenie socket
socket.on('connect', () => {
  console.log('Socket connected, id =', socket.id);
  // wyślij joinGame żeby serwer dołączył socket do pokoju jeśli trzeba
  socket.emit('joinGame', { lobbyId, name });
});

socket.on('connect_error', (err) => {
  console.error('connect_error', err);
});

// Kliknięcie przycisku
readyBtn.addEventListener('click', () => {
  console.log('Kliknięto Koniec rundy — emit readyNextOrder', { lobbyId });
  socket.emit('readyNextOrder', { lobbyId }); // wyślij event na serwer
  readyBtn.disabled = true;
  readyInfo.textContent = 'Wysłano... czekam na serwer';
});

// Odbiór eventu od serwera — wszyscy przechodzą do roundend.html
socket.on('allReadyNextOrder', () => {
  console.log('Otrzymano allReadyNextOrder — przechodzę do roundend.html');
  window.location.href = `/roundend.html?lobby=${lobbyId}&name=${encodeURIComponent(name)}`;
});
</script>
</body>
</html>
