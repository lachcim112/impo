<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Impostor - Gra</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Impostor - Gra</h1>
<div id="gameArea"></div>

<div id="readySection" style="text-align:center; margin-top:30px; display:none;">
  <button id="readyBtn">Przejdź dalej</button>
  <p id="readyInfo"></p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const params = new URLSearchParams(location.search);
const lobbyId = params.get('lobby');
const name = params.get('name');

const gameArea = document.getElementById('gameArea');
const readySection = document.getElementById('readySection');
const readyBtn = document.getElementById('readyBtn');
const readyInfo = document.getElementById('readyInfo');

const socket = io();

// Dołącz do gry i odbierz dane
socket.emit('joinGame', { lobbyId, name });

socket.on('gameData', (data) => {
  gameArea.innerHTML = `
    <h2>Twoja rola:</h2>
    <p style="font-size:1.5em; ${data.isImpostor ? 'color:red;' : ''}">
      ${data.isImpostor ? 'IMPOSTOR' : 'Gracz'}
    </p>
    <p><strong>Kategoria:</strong> ${data.categoryName}</p>
    ${data.isImpostor 
      ? '<p style="font-weight:bold; color:red;">Nie znasz hasła</p>' 
      : `<p><strong>Hasło:</strong> ${data.word}</p>`}
  `;
  readySection.style.display = 'block';
});

// Obsługa kliknięcia "Przejdź dalej"
readyBtn.addEventListener('click', () => {
  readyBtn.disabled = true;
  socket.emit('readyNext', { lobbyId }); // <- nazwa zgodna z serwerem
});

// Aktualizowanie licznika gotowych graczy
socket.on('readyProgress', ({ readyCount, total }) => { // <- nazwa zgodna z serwerem
  readyInfo.textContent = `Gotowych: ${readyCount} / ${total}`;
});

// Gdy wszyscy kliknęli
socket.on('allReadyNext', () => { // <- nazwa zgodna z serwerem
  window.location.href = `/order.html?lobby=${lobbyId}&name=${encodeURIComponent(name)}`;
});
</script>
</body>
</html>
